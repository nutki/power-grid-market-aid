<!DOCTYPE html>
<html>
<head>
<script>

function RNG(seed) {
  // LCG using GCC's constants
  this.m = 0x100000000; // 2**32;
  this.a = 1103515245;
  this.c = 12345;

  this.state = seed ? seed : Math.floor(Math.random() * (this.m-1));
}
RNG.prototype.nextInt = function() {
  this.state = (this.a * this.state + this.c) % this.m;
  return this.state;
}
RNG.prototype.nextFloat = function() {
  // returns in range [0,1]
  return this.nextInt() / (this.m - 1);
}
RNG.prototype.nextRange = function(start, end) {
  // returns in range [start, end): including start, excluding end
  // can't modulu nextInt because of weak randomness in lower bits
  var rangeSize = end - start;
  var randomUnder1 = this.nextInt() / this.m;
  return start + Math.floor(randomUnder1 * rangeSize);
}
RNG.prototype.choice = function(array) {
  return array[this.nextRange(0, array.length)];
}


Array.prototype.shuffle = function() {
 	var len = this.length;
	var i = len;
	 while (i--) {
	 	var p = rand.nextRange(0,len);
		var t = this[i];
  	this[i] = this[p];
  	this[p] = t;
 	}
};
Array.prototype.intsort = function() {
	this.sort(function(a,b){return a-b});
};

var toremove = [ 0, 0, 8, 8, 4, 0, 0];
var tostep2 = [ 0, 0, 10, 7, 7, 7, 6 ];
var toend = [ 0, 0, 21, 17, 17, 15, 14 ];
var rand;

// init_game(players, map, newplants)
function init_game() {
players = 3;
market = [];
futuremarket = [];
plants = [3,4,5,6,7,8,9,10,13,11,12,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,42,44,46,50];
phase = 2; // 2->4->5
step = 1;
turn = 1;
stack = [];
houses = 0;
playersleft = players;
sold = 0;
stack = plants;
rand = new RNG(0);

market = plants.splice(0,4);
futuremarket = plants.splice(0,4);
stack = plants.splice(1);
stack.shuffle();
stack.splice(-toremove[players]);
stack.push(99);
stack.unshift(plants[0]);
};

init_game();



function display()
{
var tmp = 'Stack: ' + stack.toString() + '<br/>';
tmp += 'Market: ' + market.toString() + '<br/>';
tmp += 'Future Market: ' + futuremarket.toString() + '<br/>';
tmp += 'Connected cities: ' + houses + '<br/>';
tmp += 'Step: ' + step + '<br/>';
tmp += 'Turn: ' + turn + '<br/>';
tmp += 'Phase: ' + phase + '<br/>';
tmp += 'Left: ' + playersleft + '<br/>';

document.getElementById("demo").innerHTML=tmp;
tmp = '';
if (phase == 2) {
for (var i = 0; i < market.length; i++)
tmp += '<button type="button" onclick="buy('+i+')">Buy '+i+'</button>';
if (turn > 1) {
tmp += '<button type="button" onclick="pass()">Pass</button>';
tmp += '<button type="button" onclick="passall()">Pass All</button>';
}
}
if (phase == 4) {
tmp += '<button type="button" onclick="build()">Build</button>';
tmp += '<button type="button" onclick="endbuild()">End Build</button>';
}
if (phase == 5 && step > 0) {
tmp += '<button type="button" onclick="endturn()">End Turn</button>';
}

document.getElementById("buttons").innerHTML=tmp;

};

function draw() {
    market = market.concat(futuremarket);
    if (stack.length) {
	var plant = stack.shift();
	if (plant == 99) {
	    stack.shuffle();
	}
	market.push(plant);
    }
    market.intsort();
    if (step < 3)
	futuremarket = market.splice(4);
};


function step3(i)
{
    step = 3;
    market.shift();
    futuremarket.pop();
    market = market.concat(futuremarket);
    futuremarket = [];
    display();
};
function do_buy(i)
{
    playersleft--;
    sold = 1;
    market.splice(i,1);
    draw();
    if (!playersleft) phase = 4;
};
function do_pass()
{
    playersleft--;
    if (!playersleft) {
        if (!sold) {
            market.shift();
            draw();
        }
        phase = 4;
    }
};
function do_build()
{
    houses++;
    while(houses >= market[0]) {
        market.shift();
        draw();
    }
}
function do_endbuild() {
    if (houses >= tostep2[players] && step == 1) {
        market.shift();
        draw();
        step = 2;
    }
    if (houses >= toend[players]) {
        step = 0;
    }
    phase = 5;
};
function do_endturn() {
    if (step < 3) {
        stack.push(futuremarket.pop());
        draw();
    } else if (market.length > 0) {
        market.shift();
        draw();
    }
    turn++;
    phase = 2;
    sold = 0;
    playersleft = players;
}
function buy(i)
{
    if (market.length > i && phase == 2) {
        do_buy();
    }
    display();
};
function pass()
{
    if (phase == 2 && turn > 1) {
        do_pass();
    }
    display();
};
function passall()
{
    while (phase == 2 && turn > 1) {
        do_pass();
    }
    display();
};
function build()
{
    if (phase == 4) {
        do_build();
    }
    display();
}
function endbuild() {
    if (phase == 4) {
        do_endbuild();
    }
    display();
};
function endturn()
{
    if (phase == 5 && step > 0) {
        do_endturn();
    }
    display();
};
</script>
</head>
<body onLoad="display()">

<h1>My First JavaScript</h1>
<p id="demo">This is a paragraph.</p>
<p id="buttons">This is a paragraph.</p>
<!--
<button type="button" onclick="buy(0)">Buy A</button>
<button type="button" onclick="buy(1)">Buy B</button>
<button type="button" onclick="buy(2)">Buy C</button>
<button type="button" onclick="buy(3)">Buy D</button>
<button type="button" onclick="buy(4)">Buy E</button>
<button type="button" onclick="buy(5)">Buy F</button>
<button type="button" onclick="pass()">Pass</button>
<button type="button" onclick="passall()">Pass All</button>
<button type="button" onclick="build()">Build</button>
<button type="button" onclick="endbuild()">End Build</button>
<button type="button" onclick="endturn()">End Turn</button>
<button type="button" onclick="step3()">Step 3</button>
   <form onSubmit='alerttest(this); return false'>        
      <input type="text">         
   </form>


   <script language="javascript">
        function alerttest()
        {
        alert("Executing jolly.exe !!!!");
        // function edited by Inderpreet singh
        }
   </script>
>
</body>
</html> 
